<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerenciador de Clientes Coruja Play</title>
    <!-- Carrega Tailwind CSS para estiliza√ß√£o moderna e responsiva -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Adiciona Font Awesome para √≠cones -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Poppins', sans-serif; }
        .scroll-list { max-height: 450px; overflow-y: auto; scrollbar-width: thin; scrollbar-color: #A78BFA #F3F4F6; }
        .scroll-list::-webkit-scrollbar { width: 8px; }
        .scroll-list::-webkit-scrollbar-track { background: #F3F4F6; border-radius: 10px; }
        .scroll-list::-webkit-scrollbar-thumb { background-color: #A78BFA; border-radius: 10px; border: 2px solid #F3F4F6; }

        .whatsapp-button {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 12px;
            background-color: #25d366; /* Cor do WhatsApp */
            color: white;
            text-decoration: none;
            border-radius: 8px;
            font-size: 1.05em;
            font-weight: 600;
            transition: background-color 0.3s, transform 0.1s;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .whatsapp-button:hover {
            background-color: #128c7e;
            transform: translateY(-1px);
        }
        .whatsapp-button i { margin-right: 8px; }

        .client-item-active:hover {
            background-color: #EEF2FF; /* indigo-50 */
        }
        .client-item-expired {
            background-color: #FEE2E2; /* red-100 */
        }
        .client-item-expired:hover {
            background-color: #FEE2E2; /* red-100 */
        }
        .status-badge-active { background-color: #10B981; color: white; } /* emerald-500 */
        .status-badge-expired { background-color: #EF4444; color: white; } /* red-500 */
        
        /* Loading spinner */
        .loader {
            width: 50px;
            height: 50px;
            border: 5px solid #E0E7FF; /* indigo-100 */
            border-bottom-color: #6366F1; /* indigo-500 */
            border-radius: 50%;
            display: inline-block;
            box-sizing: border-box;
            animation: rotation 1s linear infinite;
        }

        @keyframes rotation {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        } 
    </style>
</head>
<body class="bg-gradient-to-br from-purple-50 to-indigo-100 min-h-screen p-4 sm:p-8 text-gray-800">
    <!-- Firebase Imports -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        // Adicionando updateDoc
        import { getFirestore, doc, onSnapshot, collection, query, addDoc, serverTimestamp, deleteDoc, orderBy, updateDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        
        setLogLevel('Debug');

        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-iptv-manager';
        const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
        
        // Inicializa√ß√£o do Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        
        let currentUserId = null;
        let clientsRef = null;
        let isEditing = false; // Flag para saber se estamos editando ou adicionando
        let currentEditingClientId = null; // ID do cliente sendo editado

        // Vari√°veis globais para os elementos DOM, inicializadas no init()
        let loadingSpinner, clientListContainer, clientDetailsDiv, addClientForm, addClientModal, overlay, addClientButton, mainContent; 

        const PIX_NUMERO = "81985117522"; 
        const PIX_NOME = "Elcid Batista";
        const PIX_BANCO = "NuBank";

        // *** FUN√á√ÉO DE INICIALIZA√á√ÉO PRINCIPAL (RODA AP√ìS O DOM CARREGAR) ***
        function init() {
            // 1. Obter refer√™ncias aos elementos DOM (agora eles existem!)
            loadingSpinner = document.getElementById('loading-spinner');
            clientListContainer = document.getElementById('client-list-container');
            clientDetailsDiv = document.getElementById('client-details');
            addClientForm = document.getElementById('add-client-form');
            addClientModal = document.getElementById('add-client-modal');
            overlay = document.getElementById('modal-overlay');
            addClientButton = document.getElementById('add-client-button');
            mainContent = document.getElementById('main-content'); // Novo ID para o conte√∫do principal

            // 2. Oculta o conte√∫do principal at√© a autentica√ß√£o
            mainContent.classList.add('hidden');
            loadingSpinner.classList.remove('hidden');

            // 3. Anexar o listener do bot√£o
            if (addClientButton) {
                addClientButton.addEventListener('click', () => openModal('add'));
            }
            
            // 4. Anexar o listener de submiss√£o do formul√°rio
            addClientForm.addEventListener('submit', handleAddClientSubmit);

            // 5. Iniciar autentica√ß√£o Firebase
            setupFirebase();
        }

        // Adicionando a fun√ß√£o updateClient para expor ao renderClientDetails
        window.editClient = function(client) {
            currentEditingClientId = client.id;
            // Preenche o formul√°rio com os dados do cliente
            document.getElementById('clientName').value = client.name || '';
            document.getElementById('clientPhone').value = client.phone.replace(/\D/g, '') || ''; // Remove formata√ß√£o
            document.getElementById('clientType').value = client.type || 'Celular';
            document.getElementById('clientPlan').value = client.plan || 'Basico';
            document.getElementById('clientApp').value = client.app || 'Coruja Player V.1';
            document.getElementById('clientMac').value = client.mac || '';
            document.getElementById('clientKey').value = client.key || '';
            document.getElementById('clientExpiry').value = client.expiryDate || '';
            document.getElementById('clientValue').value = client.value ? client.value.toFixed(2) : '25.00';
            
            openModal('edit');
        };

        // Fun√ß√£o para lidar com o envio, seja adi√ß√£o ou edi√ß√£o
        async function handleAddClientSubmit(e) {
            e.preventDefault();
            const data = new FormData(addClientForm);
            
            const clientData = {
                name: data.get('clientName'),
                phone: formatPhoneNumber(data.get('clientPhone')), 
                type: data.get('clientType'),
                plan: data.get('clientPlan'),
                app: data.get('clientApp'),
                mac: data.get('clientMac'),
                key: data.get('clientKey'),
                expiryDate: data.get('clientExpiry'),
                value: parseFloat(data.get('clientValue')),
                // createdAt √© mantido na adi√ß√£o, atualizado na edi√ß√£o
                ...(isEditing ? { updatedAt: serverTimestamp() } : { createdAt: serverTimestamp() }),
            };

            try {
                if (isEditing && currentEditingClientId) {
                    // L√≥gica de Edi√ß√£o
                    const clientDocRef = doc(db, `artifacts/${appId}/users/${currentUserId}/iptv_clients`, currentEditingClientId);
                    await updateDoc(clientDocRef, clientData);
                    showCustomMessage("Cliente atualizado com sucesso!", "success");
                } else {
                    // L√≥gica de Adi√ß√£o
                    await addDoc(clientsRef, clientData);
                    showCustomMessage("Cliente adicionado com sucesso!", "success");
                }
                
                closeModal();
                addClientForm.reset();
            } catch (error) {
                console.error("Erro ao salvar cliente:", error);
                showCustomMessage(`Erro ao salvar: ${error.message}`, "error");
            }
        }


        async function setupFirebase() {
            try {
                if (initialAuthToken) {
                    await signInWithCustomToken(auth, initialAuthToken);
                } else {
                    // Esta linha √© crucial para o deploy funcionar se o Canvas n√£o fornecer o token
                    await signInAnonymously(auth); 
                }
                
                onAuthStateChanged(auth, (user) => {
                    loadingSpinner.classList.add('hidden');
                    if (user) {
                        currentUserId = user.uid;
                        clientsRef = collection(db, `artifacts/${appId}/users/${currentUserId}/iptv_clients`);
                        
                        document.getElementById('user-id-display').textContent = `ID do Usu√°rio: ${currentUserId.substring(0, 8)}...`; // Exibe parte do ID
                        mainContent.classList.remove('hidden'); // Exibe o conte√∫do principal
                        listenForClients();
                    } else {
                        // Se a autentica√ß√£o falhar, mostra a mensagem de erro e mant√©m o spinner escondido.
                        console.error("Usu√°rio n√£o autenticado ap√≥s tentativa de login.");
                        document.getElementById('error-message').textContent = `Erro: N√£o foi poss√≠vel autenticar o usu√°rio. Verifique sua conex√£o ou as regras do Firebase.`;
                        document.getElementById('error-message').classList.remove('hidden');
                    }
                });
            } catch (error) {
                // Captura erros de inicializa√ß√£o, como config inv√°lida.
                loadingSpinner.classList.add('hidden');
                console.error("Erro na autentica√ß√£o Firebase:", error);
                document.getElementById('error-message').textContent = `Erro de Inicializa√ß√£o: ${error.message}`;
                document.getElementById('error-message').classList.remove('hidden');
            }
        }

        function listenForClients() {
            // NOTE: N√£o usamos orderBy() aqui, conforme instru√ß√£o. O sort ser√° feito no JS.
            onSnapshot(clientsRef, (snapshot) => {
                const clients = [];
                snapshot.forEach((doc) => {
                    clients.push({ id: doc.id, ...doc.data() });
                });
                
                // Ordena por nome no lado do cliente
                clients.sort((a, b) => (a.name || '').localeCompare(b.name || ''));
                
                renderClientList(clients);
            }, (error) => {
                console.error("Erro ao ouvir clientes:", error);
            });
        }

        function renderClientList(clients) {
            clientListContainer.innerHTML = '';
            
            if (clients.length === 0) {
                clientListContainer.innerHTML = `<p class="text-gray-500 p-4 text-center">Nenhum cliente cadastrado ainda. <br> Clique em "Adicionar Cliente" para come√ßar!</p>`;
                clientDetailsDiv.innerHTML = `<p class="text-gray-500 p-4 bg-white rounded-xl shadow-md text-center">Selecione um cliente na lista para ver os detalhes e status de expira√ß√£o.</p>`;
                return;
            }

            clients.forEach(client => {
                const isExpired = checkExpiration(client.expiryDate);
                const statusColor = isExpired ? 'bg-red-500' : 'bg-emerald-500';
                const statusText = isExpired ? 'EXPIRADO' : 'ATIVO';

                const clientElement = document.createElement('div');
                clientElement.className = `flex justify-between items-center p-4 my-2 rounded-lg cursor-pointer transition duration-200 shadow-sm ${isExpired ? 'client-item-expired' : 'client-item-active bg-white hover:shadow-md'}`;
                clientElement.innerHTML = `
                    <div>
                        <span class="font-semibold text-lg text-indigo-800">${client.name}</span>
                        <p class="text-sm text-gray-500">${client.phone || 'N/A'}</p>
                    </div>
                    <span class="text-xs px-3 py-1 rounded-full font-bold ${statusColor} text-white">${statusText}</span>
                `;
                clientElement.addEventListener('click', () => renderClientDetails(client));
                clientListContainer.appendChild(clientElement);
            });
            
            // Renderiza o primeiro cliente por padr√£o se houver
            if (clients.length > 0) {
                 renderClientDetails(clients[0]);
            }
        }

        function renderClientDetails(client) {
            const expiryDateStr = formatDateDisplay(client.expiryDate);
            // Verifica se client.value existe e √© um n√∫mero antes de formatar
            const valorFormatado = (typeof client.value === 'number') 
                ? client.value.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })
                : 'R$ 0,00'; 
                
            const isExpired = checkExpiration(client.expiryDate);
            
            // Mensagem e link do WhatsApp (para o seu n√∫mero PIX)
            const mensagemCobranca = 
                `Ol√°, ${client.name}! Seu acesso Coruja Play expirou. ` +
                `O valor para reativa√ß√£o √© de ${valorFormatado}. ` +
                "Segue o PIX para pagamento: üí∏\n\n" +
                `PIX/Chave: ${PIX_NUMERO} (Celular)\n` +
                `Nome: ${PIX_NOME}\n` +
                `Banco: ${PIX_BANCO}\n\n` +
                "Assim que o pagamento for feito, me envie o comprovante. Obrigado!";
            const mensagemCobrancaCodificada = encodeURIComponent(mensagemCobranca);
            const linkWhatsAppCobranca = `https://wa.me/55${PIX_NUMERO}?text=${mensagemCobrancaCodificada}`;

            // Link direto para WhatsApp do cliente (sem mensagem autom√°tica, apenas abre a conversa)
            const linkWhatsAppCliente = `https://wa.me/55${client.phone.replace(/\D/g, '')}`; // Remove tudo menos d√≠gitos
            
            clientDetailsDiv.innerHTML = `
                <div class="p-8 bg-white rounded-xl shadow-xl border border-indigo-100">
                    <h2 class="text-3xl font-bold mb-5 text-indigo-800 flex items-center">
                        <i class="fas fa-user-circle mr-3 text-indigo-500"></i> ${client.name}
                    </h2>
                    
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-y-4 gap-x-6 mb-6 text-left border-t border-b py-4 border-gray-100">
                        <p><strong class="text-gray-600"><i class="fas fa-phone mr-2 text-indigo-400"></i> Celular:</strong> <a href="${linkWhatsAppCliente}" target="_blank" class="text-indigo-600 hover:underline">${client.phone || 'N/A'}</a></p>
                        <p><strong class="text-gray-600"><i class="fas fa-tag mr-2 text-indigo-400"></i> Plano:</strong> ${client.plan}</p>
                        <p><strong class="text-gray-600"><i class="fas fa-tv mr-2 text-indigo-400"></i> Acesso:</strong> ${client.type}</p>
                        <p><strong class="text-gray-600"><i class="fas fa-mobile-alt mr-2 text-indigo-400"></i> Aplicativo:</strong> ${client.app}</p>
                        <p><strong class="text-gray-600"><i class="fas fa-ethernet mr-2 text-indigo-400"></i> MAC:</strong> ${client.mac || 'N/A'}</p>
                        <p><strong class="text-gray-600"><i class="fas fa-key mr-2 text-indigo-400"></i> Chave Key/Senha:</strong> ${client.key}</p>
                        <p><strong class="text-gray-600"><i class="fas fa-money-bill-wave mr-2 text-indigo-400"></i> Valor:</strong> ${valorFormatado}</p>
                    </div>

                    <div class="p-4 rounded-lg font-semibold text-lg flex items-center justify-center gap-2 ${isExpired ? 'bg-red-500 text-white shadow-lg' : 'bg-emerald-500 text-white shadow-lg'} transition duration-300 transform hover:scale-[1.01]">
                        <i class="fas ${isExpired ? 'fa-calendar-times' : 'fa-calendar-check'}"></i> Data de Expira√ß√£o: ${expiryDateStr} 
                        (${isExpired ? 'EXPIRADO!' : 'ATIVO'})
                    </div>

                    ${isExpired ? `
                        <div class="mt-6 p-4 bg-red-50 border-l-4 border-red-400 text-red-800 rounded-md shadow-inner flex items-center gap-3">
                            <i class="fas fa-exclamation-triangle text-red-500 text-xl"></i>
                            <div>
                                <p class="font-bold text-lg">ALERTA: ACESSO EXPIRADO!</p>
                                <p>O cliente precisa pagar <span class="text-red-700 font-extrabold">${valorFormatado}</span> para reativar.</p>
                            </div>
                        </div>
                        <a href="${linkWhatsAppCobranca}" target="_blank" class="whatsapp-button mt-4">
                            <i class="fab fa-whatsapp"></i> Enviar Cobran√ßa Autom√°tica
                        </a>
                    ` : `
                        <div class="mt-6 p-4 bg-green-50 border-l-4 border-emerald-400 text-emerald-800 rounded-md shadow-inner flex items-center gap-3">
                            <i class="fas fa-check-circle text-emerald-500 text-xl"></i>
                            <div>
                                <p class="font-bold text-lg">Servi√ßo ATIVO e em dia!</p>
                                <p>Nenhuma a√ß√£o de cobran√ßa √© necess√°ria no momento.</p>
                            </div>
                        </div>
                        <a href="${linkWhatsAppCliente}" target="_blank" class="whatsapp-button bg-blue-500 hover:bg-blue-600 mt-4">
                            <i class="fab fa-whatsapp"></i> Abrir WhatsApp do Cliente
                        </a>
                    `}
                    
                    <div class="flex gap-4 mt-6">
                        <!-- Bot√£o de Edi√ß√£o -->
                        <button onclick="window.editClient(${JSON.stringify(client).replace(/"/g, '&quot;')})" class="w-full py-3 bg-indigo-500 text-white rounded-lg hover:bg-indigo-600 transition font-semibold text-base shadow-md flex items-center justify-center">
                            <i class="fas fa-edit mr-2"></i> Editar Cliente
                        </button>
                        <!-- Bot√£o de Exclus√£o -->
                        <button onclick="window.deleteClient('${client.id}')" class="w-full py-3 bg-gray-100 text-gray-600 rounded-lg hover:bg-gray-200 transition font-semibold text-base shadow-sm">
                            <i class="fas fa-trash-alt mr-2"></i> Excluir Cliente
                        </button>
                    </div>
                </div>
            `;
        }

        function checkExpiration(expiryDate) {
            if (!expiryDate) return true;
            const parts = expiryDate.split('-');
            // Usa o fuso hor√°rio local para evitar problemas de data
            const expiry = new Date(parts[0], parts[1] - 1, parts[2]);
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            return today > expiry; // Mudan√ßa para > para que a data de expira√ß√£o ainda seja ATIVO
        }

        function formatDateDisplay(dateString) {
            const parts = dateString.split('-');
            if (parts.length === 3) {
                return `${parts[2]}/${parts[1]}/${parts[0]}`;
            }
            return 'Data Inv√°lida';
        }
        
        function formatPhoneNumber(rawNumber) {
            const cleaned = ('' + rawNumber).replace(/\D/g, '');
            const match = cleaned.match(/^(\d{2})(\d{5})(\d{4})$/);
            if (match) {
                return `(${match[1]}) ${match[2]}-${match[3]}`;
            }
            return rawNumber;
        }

        function showCustomMessage(message, type = 'info') {
            const msgDiv = document.getElementById('custom-message');
            msgDiv.textContent = message;
            msgDiv.classList.remove('hidden', 'bg-green-100', 'bg-red-100', 'text-green-800', 'text-red-800');
            msgDiv.classList.add('flex', 'items-center', 'gap-2');
            
            let iconClass = '';
            if (type === 'success') {
                msgDiv.classList.add('bg-green-100', 'text-green-800');
                iconClass = 'fas fa-check-circle';
            } else if (type === 'error') {
                msgDiv.classList.add('bg-red-100', 'text-red-800');
                iconClass = 'fas fa-times-circle';
            } else {
                msgDiv.classList.add('bg-blue-100', 'text-blue-800');
                iconClass = 'fas fa-info-circle';
            }
            
            msgDiv.innerHTML = `<i class="${iconClass}"></i><span>${message}</span>`;
            
            setTimeout(() => { msgDiv.classList.add('hidden'); }, 5000);
        }

        // FUN√á√ïES DE MODAL
        function openModal(mode = 'add') {
            const modalTitle = document.getElementById('modal-title');
            const submitButton = document.getElementById('modal-submit-button');

            isEditing = (mode === 'edit');
            
            if (isEditing) {
                modalTitle.innerHTML = '<i class="fas fa-edit text-purple-500"></i> Editar Cliente';
                submitButton.innerHTML = '<i class="fas fa-save"></i> Salvar Altera√ß√µes';
            } else {
                modalTitle.innerHTML = '<i class="fas fa-user-plus text-purple-500"></i> Adicionar Novo Cliente';
                submitButton.innerHTML = '<i class="fas fa-save"></i> Salvar Cliente';
                currentEditingClientId = null; // Limpa o ID em modo de adi√ß√£o
                addClientForm.reset();
            }

            addClientModal.classList.remove('hidden');
            overlay.classList.remove('hidden');
            
            addClientModal.offsetHeight; // For√ßa reflow

            addClientModal.classList.remove('scale-95', 'opacity-0');
            addClientModal.classList.add('scale-100', 'opacity-100');
        }

        function closeModal() {
            addClientModal.classList.add('scale-95', 'opacity-0');
            addClientModal.classList.remove('scale-100', 'opacity-100');
            
            setTimeout(() => {
                addClientModal.classList.add('hidden');
                overlay.classList.add('hidden');
            }, 300); 
        }

        window.deleteClient = async function(clientId) {
            // Nota: O confirm() √© usado apenas para simular a inten√ß√£o, pois o alerta customizado √© complexo para o escopo
            if (!confirm(`Tem certeza que deseja excluir este cliente? Esta a√ß√£o √© irrevers√≠vel!`)) return;

            try {
                const clientDocRef = doc(db, `artifacts/${appId}/users/${currentUserId}/iptv_clients`, clientId);
                await deleteDoc(clientDocRef);
                showCustomMessage("Cliente exclu√≠do com sucesso!", "success");
            } catch (error) {
                console.error("Erro ao excluir cliente:", error);
                showCustomMessage(`Erro ao excluir: ${error.message}`, "error");
            }
        }
        
        // Expondo para o HTML
        window.closeModal = closeModal;
        
        // *** CORRE√á√ÉO FINAL: INICIALIZA√á√ÉO AP√ìS O DOM CARREGAR ***
        window.addEventListener('DOMContentLoaded', init);
    </script>

    <div id="error-message" class="text-red-600 bg-red-100 p-3 rounded-lg hidden"></div>
    <div id="loading-spinner" class="text-center p-8">
        <div class="loader mx-auto"></div>
        <p class="mt-4 text-indigo-700 font-medium">Carregando Gerenciador Coruja Play...</p>
    </div>
    <div id="custom-message" class="hidden fixed top-0 left-1/2 transform -translate-x-1/2 mt-6 p-4 rounded-lg shadow-xl z-50 text-base font-medium"></div>
    
    <!-- CONTE√öDO PRINCIPAL (Agora tem um ID e √© escondido at√© a autentica√ß√£o) -->
    <div id="main-content" class="max-w-6xl mx-auto bg-white p-8 rounded-2xl shadow-2xl border border-indigo-200">
        <header class="flex flex-col sm:flex-row justify-between items-center mb-8 border-b border-indigo-100 pb-6">
            <h1 class="text-4xl font-extrabold text-indigo-800 flex items-center gap-3 mb-4 sm:mb-0">
                <i class="fas fa-feather-alt text-purple-500"></i> Coruja Play Manager
            </h1>
            <div class="text-sm text-gray-500 bg-indigo-50 px-4 py-2 rounded-full shadow-inner">
                <i class="fas fa-id-badge mr-2 text-indigo-400"></i> <span id="user-id-display">ID do Usu√°rio: Carregando...</span>
            </div>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Coluna da Lista de Clientes -->
            <div class="lg:col-span-1">
                <div class="flex justify-between items-center mb-5">
                    <h2 class="text-2xl font-bold text-gray-700 flex items-center gap-2"><i class="fas fa-users text-indigo-500"></i> Meus Clientes</h2>
                    <!-- Bot√£o Adicionar: Agora com ID para vincular o evento via JavaScript -->
                    <button id="add-client-button" class="bg-gradient-to-r from-purple-600 to-indigo-600 text-white px-5 py-2.5 rounded-full shadow-lg hover:from-purple-700 hover:to-indigo-700 transition transform hover:scale-105 flex items-center gap-2 font-semibold">
                        <i class="fas fa-plus-circle"></i> Adicionar
                    </button>
                </div>
                <div id="client-list-container" class="scroll-list bg-gray-50 p-3 rounded-xl border border-gray-200 shadow-inner">
                    <!-- Clientes ser√£o renderizados aqui -->
                    <p class="text-center text-gray-400 p-4">Carregando clientes...</p>
                </div>
            </div>

            <!-- Coluna de Detalhes do Cliente / Cobran√ßa -->
            <div class="lg:col-span-2">
                <h2 class="text-2xl font-bold text-gray-700 mb-5 flex items-center gap-2"><i class="fas fa-info-circle text-indigo-500"></i> Detalhes & A√ß√µes</h2>
                <div id="client-details">
                    <p class="text-gray-500 p-6 bg-white rounded-xl shadow-md text-center border border-gray-100">Selecione um cliente na lista para ver os detalhes e status de expira√ß√£o.</p>
                </div>
            </div>
        </div>
        
        <!-- Detalhes PIX de Refer√™ncia -->
        <div class="mt-10 p-5 bg-indigo-50 rounded-xl border border-indigo-200 shadow-md">
            <h3 class="font-bold text-indigo-700 mb-3 text-xl flex items-center gap-2"><i class="fas fa-money-check-alt text-purple-500"></i> Seus Dados PIX</h3>
            <div class="grid grid-cols-1 sm:grid-cols-3 gap-3 text-gray-700">
                <p><strong>Chave:</strong> 81985117522 (Celular)</p>
                <p><strong>Nome:</strong> Elcid Batista</p>
                <p><strong>Banco:</strong> NuBank</p>
            </div>
        </div>
    </div>
    
    <!-- MODAL DE ADICIONAR/EDITAR CLIENTE -->
    <div id="modal-overlay" class="hidden fixed inset-0 bg-black bg-opacity-60 z-40 flex items-center justify-center p-4" onclick="closeModal()"></div>
    <div id="add-client-modal" class="hidden fixed bg-white p-8 rounded-xl shadow-2xl z-50 w-full max-w-lg scale-95 opacity-0 transition-all duration-300 ease-out transform-gpu">
        <h2 id="modal-title" class="text-3xl font-bold mb-6 text-indigo-700 flex items-center gap-2">
            <i class="fas fa-user-plus text-purple-500"></i> Adicionar Novo Cliente
        </h2>
        <form id="add-client-form">
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-x-4 gap-y-5">
                
                <!-- Nome -->
                <div class="sm:col-span-2">
                    <label for="clientName" class="block text-sm font-medium text-gray-700">Nome do Cliente</label>
                    <input type="text" id="clientName" name="clientName" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2.5 focus:border-indigo-500 focus:ring focus:ring-indigo-200 focus:ring-opacity-50 transition">
                </div>
                
                <!-- Celular do Cliente -->
                <div class="sm:col-span-2">
                    <label for="clientPhone" class="block text-sm font-medium text-gray-700">Celular do Cliente (apenas d√≠gitos)</label>
                    <input type="number" id="clientPhone" name="clientPhone" placeholder="Ex: 81985117522" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2.5 focus:border-indigo-500 focus:ring focus:ring-indigo-200 focus:ring-opacity-50 transition">
                </div>

                <!-- Tipo de Acesso -->
                <div>
                    <label for="clientType" class="block text-sm font-medium text-gray-700">Tipo de Acesso</label>
                    <select id="clientType" name="clientType" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2.5 focus:border-indigo-500 focus:ring focus:ring-indigo-200 focus:ring-opacity-50 transition">
                        <option value="Celular">Celular</option>
                        <option value="TV Box">TV Box</option>
                        <option value="TV Smart">TV Smart</option>
                        <option value="PC">PC</option>
                    </select>
                </div>

                <!-- Plano -->
                <div>
                    <label for="clientPlan" class="block text-sm font-medium text-gray-700">Plano</label>
                    <select id="clientPlan" name="clientPlan" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2.5 focus:border-indigo-500 focus:ring focus:ring-indigo-200 focus:ring-opacity-50 transition">
                        <option value="Basico">B√°sico</option>
                        <option value="Completo">Completo</option>
                        <option value="Premium">Premium</option>
                    </select>
                </div>
                
                <!-- Aplicativo -->
                <div class="sm:col-span-2">
                    <label for="clientApp" class="block text-sm font-medium text-gray-700">Aplicativo</label>
                    <input type="text" id="clientApp" name="clientApp" value="Coruja Player V.1" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2.5 focus:border-indigo-500 focus:ring focus:ring-indigo-200 focus:ring-opacity-50 transition">
                </div>
                
                <!-- MAC -->
                <div>
                    <label for="clientMac" class="block text-sm font-medium text-gray-700">MAC (Opcional)</label>
                    <input type="text" id="clientMac" name="clientMac" placeholder="Ex: 00:1A:2B:..." class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2.5 focus:border-indigo-500 focus:ring focus:ring-indigo-200 focus:ring-opacity-50 transition">
                </div>
                
                <!-- Chave Key/Senha -->
                <div>
                    <label for="clientKey" class="block text-sm font-medium text-gray-700">Chave Key/Senha</label>
                    <input type="text" id="clientKey" name="clientKey" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2.5 focus:border-indigo-500 focus:ring focus:ring-indigo-200 focus:ring-opacity-50 transition">
                </div>

                <!-- Data de Expira√ß√£o -->
                <div>
                    <label for="clientExpiry" class="block text-sm font-medium text-gray-700">Data de Expira√ß√£o</label>
                    <input type="date" id="clientExpiry" name="clientExpiry" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2.5 focus:border-indigo-500 focus:ring focus:ring-indigo-200 focus:ring-opacity-50 transition">
                </div>

                <!-- Valor da Mensalidade -->
                <div>
                    <label for="clientValue" class="block text-sm font-medium text-gray-700">Valor (R$)</label>
                    <select id="clientValue" name="clientValue" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2.5 focus:border-indigo-500 focus:ring focus:ring-indigo-200 focus:ring-opacity-50 transition">
                        <option value="25.00">R$ 25,00</option>
                        <option value="35.00">R$ 35,00</option>
                        <option value="40.00">R$ 40,00</option>
                        <option value="50.00">R$ 50,00</option>
                    </select>
                </div>
            </div>

            <div class="mt-8 flex justify-end space-x-4">
                <button type="button" onclick="closeModal()" class="px-5 py-2.5 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300 transition font-medium">Cancelar</button>
                <button type="submit" id="modal-submit-button" class="px-5 py-2.5 bg-gradient-to-r from-purple-600 to-indigo-600 text-white rounded-md shadow-md hover:from-purple-700 hover:to-indigo-700 transition transform hover:scale-[1.01] font-semibold flex items-center gap-2">
                    <i class="fas fa-save"></i> Salvar Cliente
                </button>
            </div>
        </form>
        <button onclick="closeModal()" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 transition">
            <i class="fas fa-times text-xl"></i>
        </button>
    </div>

</body>
</html>
